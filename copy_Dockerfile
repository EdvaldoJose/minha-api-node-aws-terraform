# Etapa 1 - build
FROM node:20-alpine AS builder
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm ci --omit=dev
COPY . .

# Etapa 2 - runtime
FROM node:20-alpine
WORKDIR /usr/src/app
COPY --from=builder /usr/src/app .
ENV NODE_ENV=production
EXPOSE 3000
CMD ["node", "src/server.js"]
#### Versão com Distroless (mais segura) ####


#### Versão simples com Alpine (padrão) ####
# FROM node:20-alpine
# WORKDIR /usr/src/app
# COPY package*.json ./
# RUN npm ci --only=production
# COPY . .
# EXPOSE 3000
# ENV NODE_ENV=production
# CMD ["node", "src/server.js"]
